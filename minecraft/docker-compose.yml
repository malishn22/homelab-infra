services:
  minecraft-api:
    build:
      context: ../..
      dockerfile: ./infra/minecraft/backend/Dockerfile
    container_name: minecraft-api
    extra_hosts:
      - "host.docker.internal:host-gateway"
    env_file:
      - ./.env
      - ../../apps/minecraft/backend/.env
    environment:
      UVICORN_RELOAD: "false"
      UVICORN_HOST: 0.0.0.0
      UVICORN_PORT: ${MINECRAFT_API_PORT}
      CONTAINER_DATA_ROOT: /data
      HOST_SERVERS_ROOT: /home/mali/homelab/apps/minecraft/backend/data/servers
    volumes:
      - ../../apps/minecraft/backend/data/instances:/data/instances
      - ../../apps/minecraft/backend/data/servers:/data/servers
      - ../../apps/minecraft/backend/data/server-defaults.properties:/data/server-defaults.properties
      - ../../apps/minecraft/backend/data/whitelist-defaults.json:/data/whitelist-defaults.json
      - ../../apps/minecraft/backend/data/ops-defaults.json:/data/ops-defaults.json
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - "${MINECRAFT_API_PORT}:${MINECRAFT_API_PORT}"
    networks:
      - homelab
    restart: unless-stopped

  minecraft-web:
    build:
      context: ../..
      dockerfile: ./infra/minecraft/frontend/Dockerfile
      args:
        VITE_API_BASE_URL: ""
    container_name: minecraft-web
    depends_on:
      - minecraft-api
    env_file:
      - ./.env
    ports:
      - "${MINECRAFT_WEB_PORT}:${MINECRAFT_WEB_INTERNAL_PORT}"
    networks:
      - homelab
    restart: unless-stopped

networks:
  homelab:
    external: true
    name: homelab
